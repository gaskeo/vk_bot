# Бот для [vk](https://vk.com)

Бот, который может генерировать сообщения 
на основе сообщений пользователей с помощью 
[цепей Маркова](https://en.wikipedia.org/wiki/Markov_chain). 
Также есть несколько команд.

# Команды

Содержание по командам 
* [Сервисные](#service)
  * [Помощь](#help)
  * [Повторить команду](#redo)
  * [Время работы бота](#uptime)
  * [Бот онлайн или нет](#alive)
  * [Очистка клавиатуры](#keyboard)
* [Обычные](#casual)
  * [Синонимы](#synonyms)
  * [Рандомный кот](#cat)
  * [Ответ да/нет](#yesno)
  * [Создать новую таблицу](#cc)
  * [Постироничный текст](#postirony)
* [С картинками](#pictures)
  * [Шакал](#shakal)
  * [Зернистость](#grain)
  * [Арабфанни](#arabfunny)
  * [Дэб](#dab)
* [Команды только для бесед](#chats)
  * [Узнать `id` беседы](#peer)
  * [Сненерировать сообщение](#generate)
  * [Узнать слова, стоящие после данного](#after_that)
  * [Выбрать случайного участника беседы](#choose_user)
  * [количество написанных сообщений от себя](#my_count)
  * [Топ по сообщениям](#top)
  * [Генерация токена для подключения к другой беседе](#generate_new_token)
  * [Присоединиться по токену](#connect)
  * [Подтвердить подключение](#accept_connect)
  * [Отправить сообщение в другую беседу](#send)
  * [Отключиться от другой беседы](#disconnect)
  * [Поставить шанс ответа](#ac)
  * [Получить шанс ответа](#gac)
  * [Поставить шанс `ху-`](#hc)
  * [Получить шанс `ху-`](#ghc)
  * [Получить количество слов в боте](#get_count_words)
  * [Переключить права на смену шансов](#tac)
  * [Показать настройки беседы](#s)
  * [Очистить словарный запас бота](#clear)
  * [Обновить бота](#update)
  * [Удалить слова из бота](#dt)
* [Команды для администраторов бота](#admin)
  * [Помощь для администраторов](#adm)
  * [Установка прав администратора](#sa)
  * [Получить список администраторов](#ga)
  * [Проверить человека на администратора](#ia)
  * [Вывести состояние потоков](#th)
  * [Отправить сообщение в беседу](#sp)
  * [Завершить работу бота](#bb)

<h2 id='service' style='display: none'></h2>

## Сервисные
### `/help`
Список всех команд

---
<h3 id='redo' style='display: none'></h2>

### `/` 
Повторить команду из ответного сообщения 

---
<h3 id='uptime' style='display: none'></h2>

### `/ut`, `/uptime`, `/время` 
Показать, сколько времени работает бот

---
<h3 id='alive' style='display: none'></h2>

### `/a`, `alive`, `живой`
Проверить, работает ли бот

---
<h3 id='keyboard' style='display: none'></h2>

### `/ck`, `/keyboard`, `/клавиатура`
Очистить все клавиатуры, если они есть 

---
<h2 id='casual' style='display: none'></h2>

## Обычные

<h3 id='synonyms' style='display: none'></h3>

### `/gs`, `/synonyms`, `/синонимы`
Ищет синонимы к слову. Использование:

`/gs [слово или слова]` или 
`/gs [ответ на сообщение]` или `/gs [пост]`

---

<h3 id='cat' style='display: none'></h3>

### `/cat`, `/кот`
Отправляет случайную картинку кота

---
<h3 id='yesno' style='display: none'></h3>

### `/yn`, `/yesno`, `ответ`
Рандомно отвечает на вопрос:

`/yn` или `/yn [вопрос]` или 
`/yn [ответ на сообщение]` или 
`/yn [пост]`

---

### `/cc`
Создать новую беседу

`/cc` или `/cc [название беседы]`

---
<h3 id='postirony' style='display: none'></h3>

### `/cp`, `/postirony`, `/постирония`
ПосТиРОниРуЕт тЕКст

`/cp [текст]` или `/cp [ответ на сообщение]` 
или `/cp [пост]`

---
<h2 id='pictures' style='display: none'></h2>

## С картинками
> Картинки могут быть **в самом сообщении** 
> или **в ответном сообщении**

<h3 id='shakal' style='display: none'></h3>

### `/cs`, `/shakal`, `/шакал` 
Шакалит картинку

`/cs` или `/cs [степень шакала, число]`

![shakal](static/photos_examples/shakal.jpg)

---
<h3 id='grain' style='display: none'></h3>

### `/cg`, `/grain`, `зернистость`
Добавляет зернистость на фотографию 

`/cg` или `/cg [степень зернистости, число]`

![grain](static/photos_examples/grain.jpg)

---
<h3 id='arabfunny' style='display: none'></h3>

### `/ca`, `/arabfunny`, `/арабфанни`
Делает арабфанни

`/ca` или `/ca [цвет на английском]`

![arabfunny](static/photos_examples/arab.jpg)

---
<h3 id='dab' style='display: none'></h3>

### `/cd`, `/dab`, `/дэб`
Создает дэб из картинки или картинок, нацелен в первую очередь на лица
> Эта команда принимает только одну или две картинки, 
> в случае с одной картинкой дэб будет стандартным,
> иначе дэб будет создан из второй картинки

![dab](static/photos_examples/dab.jpg)

---
<h2 id='chats' style='display: none'></h2>

## Команды только для бесед

<h3 id='peer' style='display: none'></h3>

### `/p`, `/peer`, `/айди`
Позволяет узнать `id` беседы для бота

---
<h3 id='generate' style='display: none'></h3>

### `/g`, `/generate`, `/скажи`
Бот сгенерирует сообщение, даже если шанс ответа равен нулю 

`/g` или `/g [слово, с которого должно начаться сообщение]`

---
<h3 id='after_that' style='display: none'></h3>

### `/at`, `/after_that`, `/после`
Вернет все слова, 
которые участники беседы писали после данного слова

`/at [слово]`

---
<h3 id='choose_user' style='display: none'></h3>

### `/l`, `/lox`, `/лох`
Вернет случайного участника беседы

---
<h3 id='my_count' style='display: none'></h3>

### `/mc`, `/my_count`, `/написал`
Узнать, сколько сообщений длинной больше 10 слов
написал пользователь

---
<h3 id='top' style='display: none'></h3>

### `/gt`, `/get_top`, `/топ`
Топ 5 участников беседы по количеству сообщений

---
<h3 id='generate_new_token' style='display: none'></h3>

### `/gnt`, `/generate_new_token`, `/сгенерируй`
Генерация токена для подключения к другой беседе 

--- 
<h3 id='connect' style='display: none'></h3>

### `/c`, `/connect`, `/присоединиться`
Подключиться к другой беседе по ее токену 

`/c [токен, который сгенерировал администратор другой беседы]`

---
<h3 id='accept_connect' style='display: none'></h3>

### `/accept_connect`
Подтвердить сопряжение с другой беседой, 
после того, как в ней ввели `/connect` с токеном этой беседы.

> Обычно эту команду можно выполнить при нажатии на клавиатуру, 
> которая открывается после команды `connect` в другой беседы 

---
<h3 id='send' style='display: none'></h3>

### `/send`, `/отправить`
Отправить сообщение в беседу, к которой присоединена данная беседа 

`/send [сообщение]`

---

### `/disconnect`
Отключиться от другой беседы

> Только для администраторов

---

### `/ac`
Позволяет поставить шанс ответа бота в беседу обычным сообщением

`/ac [шанс от 0 до 100]`

---
<h3 id='gac' style='display: none'></h3>

### `/gac`, `/get_answer`, `/шансответа`
Возвращает шанс ответа в беседу

---

### `/hc`
Поставить шанс ответа `ху-` в беседу

`/hc [шаос от 0 до 100]`

---
<h3 id='ghc' style='display: none'></h3>

### `/ghc`, `/get_huy`, `/шансхуя`
Возвращает шанс ответа `ху-` в беседу

---
<h3 id='get_count_words' style='display: none'></h3>

### `/gc`, `/get_count_words`
Позволяет посмотреть количество уникальных слов в беседе 

---

### `/tac` 
Переключить права изменения частоты ответов: 
Только администраторы или все участники беседы 
> Только для администраторов

---

### `/s`
Показать настройки беседы

--- 

### `/clear`
Очистить все слова в боте
> Осторожно! Восстановить словарный запас бота невозможно
>
> Только для администраторов 

---

### `/update`
Обновляет чат, если бот завис, 
все настройки частоты ответа переводит в стандартные значения

---

### `/dt`
Удаляет слова из словарного запаса бота

`/dt [слова]` или `/dt [ответ на сообщение]`

---
<h2 id='admin' style='display: none'></h2>

## Только для администраторов бота 

### `/adm`
Справка по командам для админа

---

### `/sa` 
Дать права администратора пользователю 

`/sa [ссылка на пользователя] [уровень администрирования]`

---

### `/ga` 
Получить список администраторов 

---

### `/ia`
Проверить, является ли пользователь админом

`/ia [ссылка на пользователя]`

---

### `/th`
Проверить живые потоки

---

### `/sp`
Отправить сообщение от лица бота в беседу 
`/sp [peer_id] [сообщение]`

---

### `/bb`
Завершить работу бота

---

# Установка на сервер 

1. Скачать и настроить [redis](https://redis.io/)
2. Заполнить пропуски `config.env`

| Ключ | Что значит |
|:----:|------------|
| `vk_group_token` | [Токен](https://dev.vk.com/api/access-token/getting-started) группы |
|  `vk_group_id`   | `id` группы, для которой создан токен                               |
| `vk_group_name`  | Название группы                                                     | 
|  `chief_admin`   | `id` главного администратора для бота                               |
|   `redis_pass`   | Пароль для redis                                                    |
|   `font_linux`   | Абсолютный путь до папки `fonts`: `/.../static/fonts/`              |
|  `font_windows`  | Аналогично                                                          |

3. Скачать зависимости из `requirements.txt`:
   
   `pip install -r requirements.txt`
4. Запустить бота

  `python core.py`